<!DOCTYPE HTML>
<html>
{% load staticfiles %}

<!--<link rel="stylesheet" type="text/css" href="{% static 'events/style.css' %}" />-->

{% if user.is_authenticated %}
<h1>hello {{ user.username }}!</h1>
<a href="/events/logout/">Logout</a><br />

<div id="notifications_panel">
    <h2>Notifications</h2>
    {% for notification in user.notification_set.all %}
        <form action="{% url 'events:manageNotification' %}" method="post">
        {% csrf_token %}
            <p> {{ notification }} <input type="submit" name="dismiss" value="Dismiss"/></p>
                <div style="display: none;"><input type="text" name="notificationID" value="{{ notification.id }}"</input></div>
        </form>
    {% endfor %}
</div>

<div id="menu_container">
<h2>My Events</h2>
    <h3>Stage 1: View how many people have responded to request </h3>

    {% if latest_event_list %}
        <ul>
            {% for event in latest_event_list %}
                <!-- not time efficient but works for reasonable amount of data -->
                {% if event.creator == user.username or user.username == "admin" %}
                    <form action="{% url 'events:manageCreator' %}" method="post">
                    {% csrf_token %}
                    <div style="display: none;"><input type="text" name="eventID" value="{{ event.id }}"</input></div>
                    <li>
                        <a href="{% url 'events:detail' event.id %}">{{ event.title }}</a>
                        <input type="submit" name="delete" id="delete_button" value="Delete Event"/>
                        <input type="submit" name="getTimes" value="Get Times" />

                        {% for invitee in event.invitee_set.all %}
                            {% if invitee.rsvpAccepted %}
                                <p> Responded: {{ invitee.name }} </p>
                            {% else %}
                                <p> Not Responded: {{ invitee.name }} </p>
                            {% endif %}
                        {% endfor %}

                    </li>
                    </form>
                {% endif %}
            {% endfor %}
        </ul>
    {% else %}
        <p>No events are available.</p>
    {% endif %}

<h2>Events Invited To</h2>
<h3>Stage 1: Accept/Decline Events</h3>
{% if latest_event_list %}
    <ul>
        {% for event in latest_event_list %}
            {% for invitee in event.invitee_set.all %}

                <!-- not time efficient but works for reasonable amount of data -->
                {% if invitee.name == user.username and not invitee.rsvpAccepted %}
                    <form action="{% url 'events:manageInvitee' %}" method="post">
                    {% csrf_token %}
                    <li><a href="{% url 'events:detail' event.id %}">{{ event.title }}</a>
                        <div style="display: none;"><input type="text" name="eventID" value="{{ event.id }}"/></div>
                        <div style="display: none;"><input type="text" name="username" value="{{ user.username }}"/></div>
                        <input type="submit" name="accept" value="Accept"/>
                        <input type="submit" name="decline" value="Decline"/></li>
                    </form>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </ul>

{% else %}
    <p>No events are available.</p>
{% endif %}

<h2>Events Pending</h2>
<h3>Stage 1: Pending Creator Time Generation</h3>
{% if latest_event_list %}
    <ul>
        {% for event in latest_event_list %}
            {% for invitee in event.invitee_set.all %}

                <!-- not time efficient but works for reasonable amount of data -->
                {% if invitee.name == user.username and invitee.rsvpAccepted and not event.isScheduled %}
                    <p><a href="{% url 'events:detail' event.id %}">{{ event.title }}</a></p>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </ul>

{% else %}
    <p>No events are available.</p>
{% endif %}

<h2>Create Event</h2>
<h3> {{error}} </h3>
<form action="{% url 'events:add' %}" method="post">    
{% csrf_token %}
<p>Title: <input type="text" name="title" id="" value="{{ title }}"></p>
<p>Desc: <input type="text" name="desc" id="" value="{{ desc }}"></p>
<p>Start Date: <input type="date" name="start_date" id="" value="{{ start_date }}"></p>
<p>End Date: <input type="date" name="end_date" id="" value="{{ end_date }}"></p>
<p>Start Time: <input type="time" name="start_time" id="" value="{{ start_time }}"></p>
<p>End Time: <input type="time" name="end_time" id="" value="{{ end_time }}"></p>
<p>Invitees: <input type="text" name="invitees" id="" value="{{ invitees }}"></p>
<div style="display: none;"><input type="text" name="creator" value="{{ user.username }}"</input></div>
<input type="submit" value="Add" />
{% else %}
<h1>hello world!</h1>
{% endif %}
</form>

</div>
</html>